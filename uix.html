<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D-Physik-Test</title>
    <style>
        body { margin: 0; overflow: hidden; }
        canvas { display: block; }
    </style>
</head>
<body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ammo.js/0.0.10/ammo.js"></script>
<script>
    let scene, camera, renderer, world;
    let ball, ground;

    Ammo().then(() => {
        init();
        animate();
    });

    function init() {
        // Szene erstellen
        scene = new THREE.Scene();

        // Kamera erstellen
        camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 5, 10);

        // Renderer erstellen
        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // Licht hinzufügen
        const light = new THREE.DirectionalLight(0xffffff, 1);
        light.position.set(5, 10, 7.5).normalize();
        scene.add(light);

        // Physik-Welt erstellen
        const collisionConfiguration = new Ammo.btDefaultCollisionConfiguration();
        const dispatcher = new Ammo.btCollisionDispatcher(collisionConfiguration);
        const broadphase = new Ammo.btDbvtBroadphase();
        const solver = new Ammo.btSequentialImpulseConstraintSolver();
        world = new Ammo.btDiscreteDynamicsWorld(dispatcher, broadphase, solver, collisionConfiguration);
        world.setGravity(new Ammo.btVector3(0, -9.8, 0));

        // Boden erstellen
        const planeGeometry = new THREE.PlaneGeometry(100, 100);
        const planeMaterial = new THREE.MeshPhongMaterial({ color: 0x228B22 });
        ground = new THREE.Mesh(planeGeometry, planeMaterial);
        ground.rotation.x = - Math.PI / 2;
        scene.add(ground);

        // Physik für den Boden
        const groundShape = new Ammo.btBoxShape(new Ammo.btVector3(50, 1, 50));
        const groundTransform = new Ammo.btTransform();
        groundTransform.setIdentity();
        groundTransform.setOrigin(new Ammo.btVector3(0, -1, 0));
        const groundMotionState = new Ammo.btDefaultMotionState(groundTransform);
        const groundLocalInertia = new Ammo.btVector3(0, 0, 0);
        const groundRigidBodyInfo = new Ammo.btRigidBodyConstructionInfo(0, groundMotionState, groundShape, groundLocalInertia);
        const groundRigidBody = new Ammo.btRigidBody(groundRigidBodyInfo);
        world.addRigidBody(groundRigidBody);

        // Kugel erstellen
        const ballGeometry = new THREE.SphereGeometry(1, 32, 32);
        const ballMaterial = new THREE.MeshPhongMaterial({ color: 0xff0000 });
        ball = new THREE.Mesh(ballGeometry, ballMaterial);
        scene.add(ball);

        // Physik für die Kugel
        const ballShape = new Ammo.btSphereShape(1);
        const ballTransform = new Ammo.btTransform();
        ballTransform.setIdentity();
        ballTransform.setOrigin(new Ammo.btVector3(0, 10, 0));
        const ballMotionState = new Ammo.btDefaultMotionState(ballTransform);
        const ballLocalInertia = new Ammo.btVector3(0, 0, 0);
        ballShape.calculateLocalInertia(1, ballLocalInertia);
        const ballRigidBodyInfo = new Ammo.btRigidBodyConstructionInfo(1, ballMotionState, ballShape, ballLocalInertia);
        const ballRigidBody = new Ammo.btRigidBody(ballRigidBodyInfo);
        ball.userData.physicsBody = ballRigidBody;
        world.addRigidBody(ballRigidBody);

        // Größenänderung des Fensters behandeln
        window.addEventListener('resize', onWindowResize, false);
    }

    function animate() {
        requestAnimationFrame(animate);

        const deltaTime = 1 / 60;

        // Physik-Welt updaten
        world.stepSimulation(deltaTime, 10);

        // Kugelposition aus der Physik-Engine updaten
        const ballPhysicsBody = ball.userData.physicsBody;
        const ballTransform = new Ammo.btTransform();
        ballPhysicsBody.getMotionState().getWorldTransform(ballTransform);

        const origin = ballTransform.getOrigin();
        ball.position.set(origin.x(), origin.y(), origin.z());

        // Szene rendern
        renderer.render(scene, camera);
    }

    function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    }
</script>

</body>
</html>
